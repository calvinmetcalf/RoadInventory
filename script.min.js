[].indexOf||(Array.prototype.indexOf=function(t,e,a){a=this.length;e=(a+~~e)%a;while(e<a&&(!(e in this)||this[e]!==t)){e++}if(e^a){return e}else{return-1}});function toGeoJSON(t,e){var a={type:"FeatureCollection",features:[]};var r=t.features.length;var n=0;while(r>n){var s=t.features[n];var i={type:"Feature",properties:s.attributes};if(s.geometry.x){i.geometry=o(s.geometry)}else if(s.geometry.points){i.geometry=l(s.geometry)}else if(s.geometry.paths){i.geometry=h(s.geometry)}else if(s.geometry.rings){i.geometry=p(s.geometry)}a.features.push(i);n++}function o(t){return{type:"Point",coordinates:[t.x,t.y]}}function l(t){if(t.points.length===1){return{type:"Point",coordinates:t.points[0]}}else{return{type:"MultiPoint",coordinates:t.points}}}function h(t){if(t.paths.length===1){return{type:"LineString",coordinates:t.paths[0]}}else{return{type:"MultiLineString",coordinates:t.paths}}}function p(t){if(t.rings.length===1){return{type:"Polygon",coordinates:t.rings}}else{var e=u(t.rings);var a=e[0];var r=e[1];var n=[];if(r.length===0){var s=a.length;var i=0;while(s>i){n.push([a[i]])}return{type:"MultiPolygon",coordinates:n}}else if(a.length===1){r.unshift(a[0]);return{type:"Polygon",coordinates:r}}else{return{type:"MultiPolygon",coordinates:a,holes:r}}}}function u(t){var e=[];var a=[];var r=t.length;var n=0;while(r>n){if(m(t[n])){e.push(t[n])}else{a.push(t[n])}n++}return[e,a]}function m(t){var e=t.length-1;var a=0;var r=0;while(e>a){r+=t[a][0]*t[a+1][1]-t[a+1][0]*t[a][1];a++}return r<=0}if(e){e(a)}else{return a}}var module=module||false;if(!!module&&typeof module!==undefined)module.exports=toGeoJSON;(function(t){var e=function(){var e=t.documentMode;return"onhashchange"in t&&(e===undefined||e>7)}();L.Hash=function(t){this.onHashChange=L.Util.bind(this.onHashChange,this);if(t){this.init(t)}};L.Hash.prototype={map:null,lastHash:null,parseHash:function(t){if(t.indexOf("#")==0){t=t.substr(1)}var e=t.split("/");if(e.length==3){var a=parseInt(e[0],10),r=parseFloat(e[1]),n=parseFloat(e[2]);if(isNaN(a)||isNaN(r)||isNaN(n)){return false}else{return{center:new L.LatLng(r,n),zoom:a}}}else{return false}},formatHash:function(t){var e=t.getCenter(),a=t.getZoom(),r=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return"#"+[a,e.lat.toFixed(r),e.lng.toFixed(r)].join("/")},init:function(t){this.map=t;this.map.on("moveend",this.onMapMove,this);this.lastHash=null;this.onHashChange();if(!this.isListening){this.startListening()}},remove:function(){this.map=null;if(this.isListening){this.stopListening()}},onMapMove:function(t){if(this.movingMap||this.map.getZoom()===0){return false}var e=this.formatHash(this.map);if(this.lastHash!=e){location.replace(e);this.lastHash=e}},movingMap:false,update:function(){var t=location.hash;if(t===this.lastHash){return}var e=this.parseHash(t);if(e){this.movingMap=true;this.map.setView(e.center,e.zoom);this.movingMap=false}else{this.onMapMove(this.map)}},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var t=this;this.changeTimeout=setTimeout(function(){t.update();t.changeTimeout=null},this.changeDefer)}},isListening:false,hashChangeInterval:null,startListening:function(){if(e){L.DomEvent.addListener(t,"hashchange",this.onHashChange)}else{clearInterval(this.hashChangeInterval);this.hashChangeInterval=setInterval(this.onHashChange,50)}this.isListening=true},stopListening:function(){if(e){L.DomEvent.removeListener(t,"hashchange",this.onHashChange)}else{clearInterval(this.hashChangeInterval)}this.isListening=false}};L.hash=function(t){return new L.Hash(t)};L.Map.prototype.addHash=function(){this._hash=L.hash(this)};L.Map.prototype.removeHash=function(){this._hash.remove()}})(window);L.GeoJSON.AJAX=L.GeoJSON.extend({defaultAJAXparams:{dataType:"json",callbackParam:"callback"},initialize:function(t,e){this._url=t;var a=L.Util.extend({},this.defaultAJAXparams);for(var r in e){if(this.defaultAJAXparams.hasOwnProperty(r)){a[r]=e[r]}}this.ajaxParams=a;this._layers={};L.Util.setOptions(this,e);if(this._url){this.addUrl(this._url)}},addUrl:function(t){var e=this;e._url=t;if(this.ajaxParams.dataType.toLowerCase()==="json"){L.Util.ajax(t,function(t){e.addData(t)})}else if(this.ajaxParams.dataType.toLowerCase()==="jsonp"){L.Util.jsonp(t,function(t){e.addData(t)},e.ajaxParams.callbackParam)}},refresh:function(t){t=t||this._url;this.clearLayers();this.addUrl(t)}});L.Util.ajax=function(t,e){var a,r=new XMLHttpRequest;r.open("GET",t);r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){a=JSON.parse(r.responseText);e(a)}};r.send()};L.Util.jsonp=function(t,e,a,r){var n,s,i;var a=a||"callback";if(r){n=r}else{i="_"+Math.floor(Math.random()*1e6);n="L.Util.jsonp.cb."+i}L.Util.jsonp.cb[i]=e;var o=L.DomUtil.create("script","",document.getElementsByTagName("body")[0]);o.type="text/javascript";if(t.indexOf("?")===-1){s=t+"?"+a+"="+n}else{s=t+"&"+a+"="+n}o.src=s};L.Util.jsonp.cb={};L.geoJson.ajax=function(t,e){return new L.GeoJSON.AJAX(t,e)};var m=L.map("map").setView([42.2,-71],8),r=L.tileLayer("//services.massdot.state.ma.us/ArcGIS/rest/services/RoadInventory/Roads/MapServer/tile/{z}/{y}/{x}",{attribution:'Road Tiles from <a href="http://www.massdot.state.ma.us/planning/Main.aspx" target="_blank">MassDOT Planning</a>'}).addTo(m),t=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"});var mapQuestAttr='Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; ';var osmDataAttr='Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';m.addHash();var mopt={url:"http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpeg",options:{attribution:mapQuestAttr+osmDataAttr,subdomains:"1234"}};var osm=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:osmDataAttr});var stamen={atribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'};stamen.background=L.tileLayer("http://{s}.tile.stamen.com/terrain-background/{z}/{x}/{y}.jpg",{attribution:stamen.atribution}).addTo(m);stamen.waterColor=L.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",{attribution:stamen.atribution});var osmDE=L.tileLayer("http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",{attribution:'&copy <a href=" http://www.openstreetmap.org/" title="OpenStreetMap">OpenStreetMap</a>  and contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/" title="CC-BY-SA">CC-BY-SA</a>',maxZoom:18,subdomains:"abc"});var cloudmade={url:"http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/1/256/{z}/{x}/{y}.png"};cloudmade.orig=L.tileLayer(cloudmade.url);var mq=L.tileLayer(mopt.url,mopt.options);var baseMaps={"Map Quest":mq,"Open Street Map":osm,"Open Street Map DE":osmDE,ESRI:t,Terrain:stamen.background,"Water Color":stamen.waterColor,"Cloud Made":cloudmade.orig};var tlayer=L.layerGroup();var overlayMaps={Roads:r,test:tlayer};var lc=L.control.layers(baseMaps,overlayMaps);lc.addTo(m);var popUp,clickable=L.geoJson("",{style:{opacity:0}}).addTo(m);m.on("click",getInfo);function getInfo(t){function e(t){return(t-4)*2}var a=m.getZoom();var r=t.latlng;var n=r.lat;var s=r.lng;var i="http://services.massdot.state.ma.us/ArcGIS/rest/services/RoadInventory/Roads/MapServer/{layer}/query?geometry={lng}%2C{lat}&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIndexIntersects&returnGeometry=false&outSR=4326&outFields=Jurisdiction,StreetName,FunctionalClassification&f=json";var o={layer:e(a),lng:s,lat:n};var l=L.Util.template(i,o);L.Util.jsonp(l,function(t){var e=[];for(var a in t.features){var n=t.features[a].attributes.StreetName;if(e.indexOf(n)===-1){e.push(n)}}var s=L.Util.template("<div><ol><li>{el}</li></ol></div>",{el:e.join("</li><li>")});popUp=L.popup().setLatLng(r).setContent(s).openOn(m)})}